<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مولد المقالات الذكي</title>
    <script>
        const settings = {
            wpUrl: localStorage.getItem('wpUrl') || '',
            wpUsername: localStorage.getItem('wpUsername') || '',
            wpAppPassword: localStorage.getItem('wpAppPassword') || ''
        };

        window.addEventListener('DOMContentLoaded', () => {
            const postTitleInput = document.getElementById('postTitle');
            const newsContentInput = document.getElementById('newsContent');
            const wordpressPostButton = document.getElementById('wordpressPost');
            const statusBox = document.getElementById('statusBox');

            document.getElementById('wpUrl').value = settings.wpUrl;
            document.getElementById('wpUsername').value = settings.wpUsername;
            document.getElementById('wpAppPassword').value = settings.wpAppPassword;

            document.getElementById('saveSettings').addEventListener('click', () => {
                settings.wpUrl = document.getElementById('wpUrl').value.trim();
                settings.wpUsername = document.getElementById('wpUsername').value.trim();
                settings.wpAppPassword = document.getElementById('wpAppPassword').value.trim();
                localStorage.setItem('wpUrl', settings.wpUrl);
                localStorage.setItem('wpUsername', settings.wpUsername);
                localStorage.setItem('wpAppPassword', settings.wpAppPassword);
                showStatus('تم الحفظ!', 'تم حفظ إعدادات ووردبريس بنجاح.', 'success');
            });

            function showStatus(title, message, type = 'info') {
                statusBox.innerHTML = `<strong>${title}</strong><br>${message}`;
                statusBox.className = `status ${type}`;
                statusBox.style.display = 'block';
            }

            function hideStatus() {
                statusBox.style.display = 'none';
            }

            wordpressPostButton.addEventListener('click', async () => {
                if (!settings.wpUrl || !settings.wpUsername || !settings.wpAppPassword) {
                    showStatus('خطأ في إعدادات ووردبريس', 'الرجاء إدخال رابط الموقع واسم المستخدم وكلمة مرور التطبيق وحفظها.', 'error');
                    return;
                }

                const title = postTitleInput.value.trim();
                const content = newsContentInput.value.trim();

                if (!title || !content) {
                    showStatus('تنبيه', 'الرجاء التأكد من كتابة عنوان المقال ومحتوى المقال.', 'warning');
                    return;
                }

                try {
                    const cleanUrl = settings.wpUrl.replace(/\/+$/, "");
                    const targetUrl = `${cleanUrl}/wp-json/wp/v2/posts`;
                    const authHeader = 'Basic ' + btoa(`${settings.wpUsername}:${settings.wpAppPassword}`);

                    const postData = {
                        title: title,
                        content: content,
                        status: 'draft' // التعديل: النشر كمسودة
                    };

                    const originalButtonText = wordpressPostButton.innerHTML;
                    wordpressPostButton.innerHTML = 'جاري الترحيل...';
                    wordpressPostButton.disabled = true;
                    hideStatus();

                    const response = await fetch(targetUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': authHeader
                        },
                        body: JSON.stringify(postData)
                    });

                    if (response.ok) {
                        const result = await response.json();
                        showStatus('تم بنجاح!', `تم ترحيل المقال كمسودة إلى ووردبريس. <a href="${result.link}" target="_blank">مشاهدة المسودة</a>`, 'success');
                        wordpressPostButton.innerHTML = 'تم الترحيل!';
                    } else {
                        const errorData = await response.json();
                        let msg = errorData.message || `خطأ HTTP: ${response.status}`;
                        showStatus('فشل الترحيل!', msg, 'error');
                    }

                } catch (e) {
                    showStatus('فشل الترحيل!', 'حدث خطأ في الاتصال بالموقع: ' + e.message, 'error');
                } finally {
                    wordpressPostButton.innerHTML = 'ترحيل المسودة إلى ووردبريس';
                    wordpressPostButton.disabled = false;
                }
            });
        });
    </script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background:#f9f9f9; }
        input, textarea { width: 100%; padding: 8px; margin:5px 0 10px 0; }
        button { padding: 10px 20px; background: #1E40AF; color: white; border: none; cursor:pointer; }
        button:disabled { opacity: 0.6; cursor: not-allowed; }
        .status { padding: 10px; margin-bottom: 15px; border-radius: 5px; display:none; }
        .status.success { background: #D1FAE5; color:#065F46; }
        .status.error { background: #FEE2E2; color:#991B1B; }
        .status.warning { background: #FEF3C7; color:#78350F; }
        .status.info { background: #DBEAFE; color:#1E40AF; }
        a { color: #1E40AF; text-decoration: none; }
        a:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <h1>مولد المقالات الذكي</h1>

    <h2>إعدادات ووردبريس</h2>
    <input type="text" id="wpUrl" placeholder="رابط موقع ووردبريس">
    <input type="text" id="wpUsername" placeholder="اسم المستخدم">
    <input type="password" id="wpAppPassword" placeholder="كلمة مرور التطبيق">
    <button id="saveSettings">حفظ الإعدادات</button>

    <h2>مقال جديد</h2>
    <input type="text" id="postTitle" placeholder="عنوان المقال">
    <textarea id="newsContent" rows="10" placeholder="نص المقال..."></textarea>

    <button id="wordpressPost">ترحيل المسودة إلى ووردبريس</button>

    <div id="statusBox" class="status"></div>
</body>
</html>
